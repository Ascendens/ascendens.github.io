---
extends: _layouts.post
permalink: carew-vstupitelnyj-tekst-bez-front-matter.html
title: Carew. Вступительный текст без "front matter"
description: Определение вступительного (intro) текста в основном на страницах, сгенерированных через Carew
date: 1486065480
---

Просматривая категорию публикаций, пользователь вряд ли ожидает увидеть длинное полотно полных текстов.
Намного логичнее отображать в таких местах специальное вступительное содержимое. О том, как я реализовал
эту функциональность в генераторе статических сайтов Carew, я и хочу сегодня рассказать.

<!--more-->

<h2 id="">Зачем мне понадобился вступительный текст<a href="#" class="anchor">#</a></h2>

Генератор статических сайтов [Carew](https://carew.github.io/), по моему скромному мнению, "из коробки" поддерживает
почти все, что нужно для ведения среднестатистического блога — посты, страницы, категории, теги и темы.
Списки категорий, к сожалению, а может к счастью, представлены достаточно аскетично — просто список ссылок
на материалы, где анкорами являются заголовки. Но, многим, в том числе и мне, этого покажется мало.
Просматривая категорию, под заголовком, я ожидаю увидеть намек на то, о чем же все таки идет речь.

<h2 id="-2">Как отображать вступительный текст<a href="#-2" class="anchor">#</a></h2>

Итак, первое, что придет на ум разработчику, использующему любой генератор статических сайтов — это
[front matter](https://carew.github.io/documentation.html#front-matter). Решение простое и даже
логичное, но попытка использовать там форматирование заканчивается неудачей. Аналогично для нескольких
строк текста.

Раз _front matter_ для наших целей не подходит, будем использовать область основного текста. Просто
введем понятие разделителя между основным и вступительным содержимым. Пусть это будет HTML комментарий
такого вида:

```html
<!--more-->
```

Теперь нужно сообщить движку о том, что нужно как-то обрабатывать новоявленный разделитель. Так как
нашей изначальной целью является список документов, создаем/открываем файл `layouts/blocks.html.twig`
и находим в нем блок `documents`. Именно здесь и описан нужный нам вывод.

```twig
{% block documents %}
{% spaceless -%}
    <ul class="{% block ul_class '' %}">
        {% for document in documents %}
            <li class="{% block li_class '' %}">
                {% block document_list %}
                    <a href="{{ render_document_path(document) }}">
                        {{ render_document_title(document) }}
                    </a>
                {% endblock %}
            </li>
        {% endfor %}
    </ul>
{%- endspaceless %}
{% endblock %}
```

Для упрощения, давайте выводить вступление прямо под ссылкой.

```twig
<a href="{{ render_document_path(document) }}">
    {{ render_document_title(document) }}
</a>
{{ render_document_intro(document) }}
```

Понять, почему функция вывода вступления называна именно <code>render_document_intro</code> можно, взглянув на
[этот раздел документации](https://carew.github.io/cookbook/helper.html#render-document), я же просто
представлю вам свой вариант реализации данного блока:

```twig
{% block document_intro %}
    {% spaceless -%}
        {% set parts = document.body|split('<!--more-->') %}
        {% if 2 == parts|length %}
            {{ parts[0]|raw }}
        {% endif %}
    {%- endspaceless %}
{% endblock %}
```

Алгоритм элементарен — разделяем текст по `<!--more-->` и выводим первую часть. Надеюсь, кому-нибудь прогодится.
